<IfModule mod_ssl.c>
<VirtualHost *:443>
  ServerName adup.uwc.ufanet.ru:443
  ServerAdmin webmaster@uwc.ufanet.ru

  DocumentRoot /opt/adup/public

  #LogLevel info ssl:debug
  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  SSLEngine on
  SSLCertificateFile /etc/ssl/certs/u.pem
  SSLCertificateKeyFile /etc/ssl/private/u.key
  SSLVerifyClient none

  # SSL Engine Options
  #<FilesMatch "\.(cgi|shtml|phtml|php)$">
  #  SSLOptions +StdEnvVars
  #</FilesMatch>

  #PerlHeaderParserHandler Lemonldap::NG::Handler

  ProxyRequests Off
  ProxyPreserveHost On

  ProxyPass /css !
  ProxyPass /fonts !
  ProxyPass /img !
  ProxyPass /js !

  <Directory /opt/adup/public>
    SSLRequireSSL
    AllowOverride None
    Options FollowSymLinks
    Require all granted
  </Directory>

  # Set address of adup container
  ProxyPass / http://172.17.0.4:3000/ keepalive=On
  ProxyPassReverse / http://172.17.0.4:3000/
  RequestHeader set X-Forwarded-Proto "https"

  <Proxy *>
    Require all granted
  </Proxy>

</VirtualHost>
</IfModule>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
